# Implementation Plan: Next.js Frontend Application

**Branch**: `004-frontend-nextjs` | **Date**: 2025-12-24 | **Spec**: [specs/004-frontend-nextjs/spec.md](./spec.md)
**Input**: Feature specification from `/specs/004-frontend-nextjs/spec.md`

**Note**: This template is filled in by the `/sp.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Build a modern, responsive web frontend using Next.js 16+ (App Router) that provides a complete user interface for the todo application with Better Auth authentication. This is Phase II - Stage 3 (Frontend Development) of the Evolution of Todo project, integrating with the completed backend API to deliver a production-ready full-stack web application deployed to Vercel.

## Technical Context

**Language/Version**: TypeScript 5+ (strict mode), React 19+, Next.js 16+ (App Router)
**Primary Dependencies**: Next.js 16+, Better Auth (authentication), Tailwind CSS 4+ (styling), React Hook Form (forms), Zod (validation), Axios (HTTP client)
**Storage**: N/A (frontend delegates to backend API at `http://localhost:8000` dev, Vercel production URL)
**Testing**: Vitest + React Testing Library (unit tests), Playwright (E2E integration tests)
**Target Platform**: Web browsers (Chrome, Firefox, Safari, Edge - latest 2 versions), mobile web (iOS Safari, Chrome Mobile)
**Project Type**: Web (frontend SPA with SSR capabilities via Next.js App Router)
**Performance Goals**: Page load < 2s on 4G, Lighthouse score > 90 (Performance, Accessibility, Best Practices), UI interactions < 100ms feedback
**Constraints**: Mobile-first responsive design (320px to 1440px+), WCAG 2.1 AA accessibility, JWT token security (httpOnly cookies), retry logic (3 attempts with exponential backoff)
**Scale/Scope**: 8 user stories (signup, login, view tasks, create task, toggle complete, edit task, delete task, responsive design), ~15 components, deploy to Vercel with HTTPS

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Principle I: Spec-Driven Development (SDD) ✅
- **Status**: PASS
- **Evidence**: Feature spec exists at `specs/004-frontend-nextjs/spec.md` (1260 lines)
- **Compliance**: Spec refined through `/sp.clarify` with 2 high-impact clarifications integrated (JWT storage, API retry strategy)

### Principle II: Agentic Dev Stack Workflow ✅
- **Status**: PASS
- **Evidence**: Following workflow: `/sp.specify` (complete) → `/sp.clarify` (complete) → `/sp.plan` (in progress) → `/sp.tasks` (pending) → `/sp.implement` (pending)
- **Compliance**: Plan will be approved before task generation

### Principle III: Reusable Intelligence ⚠️
- **Status**: ADVISORY (not blocking for frontend)
- **Note**: Reusable Intelligence applies more to backend skills/agents. Frontend components are feature-specific for this stage.
- **Future**: Consider extracting auth utilities or API client as reusable modules in later phases

### Principle IV: Clean Code and Structure ✅
- **Status**: PASS
- **Compliance**:
  - TypeScript 5+ with strict mode (enforces type safety)
  - Monorepo structure: `/frontend/` directory with clear separation (app/, components/, lib/, types/)
  - Dependencies managed via pnpm (Node.js package manager)
  - Separation of concerns: components (UI), services (API client), lib (utilities), types (interfaces)

### Principle V: No Manual Interventions ✅
- **Status**: PASS
- **Compliance**: All code will be generated by Claude Code. This planning session is part of the agentic workflow.
- **Documentation**: Sessions will be documented in `frontend/CLAUDE.md` and root `CLAUDE.md`

### Principle VI: Bonus Alignment ⚠️
- **Status**: ADVISORY
- **Note**: Frontend itself doesn't directly earn bonus points, but enables bonus features:
  - Phase III: AI Chatbot (+200, requires this UI foundation)
  - Multi-language Support (+100, can be added to UI later)
  - Voice Commands (+200, can integrate with frontend)

### Principle VII: Ethical and Compliant Development ✅
- **Status**: PASS
- **Compliance**:
  - User data isolation: JWT tokens enforce user-specific data access
  - Secure storage: httpOnly cookies for JWT (XSS protection per NFR-006)
  - Error handling: No sensitive data leakage (401 redirects, user-friendly messages)
  - Scalability: Stateless frontend, delegates to backend API

### Principle VIII: Gradual Feature Implementation ✅
- **Status**: PASS
- **Compliance**: Frontend is Stage 3 of Phase II, depends on:
  - Stage 1: Database & Models (002-database-setup) ✅
  - Stage 2: Backend API (003-backend-api) ✅
  - Stage 3: Frontend UI (this feature)
- **Hierarchy**: Authentication (P0) → View Tasks (P1) → Create Tasks (P1) → Toggle Complete (P1) → Edit (P2) → Delete (P2) → Responsive Design (P1)

### Development Standards Compliance ✅
- **Testing**: Vitest + React Testing Library (unit), Playwright (E2E), target 70%+ coverage (MVP), 75%+ (production-ready per Phase II)
- **Branch**: `004-frontend-nextjs` (follows `###-feature-name` format)
- **Environment**: `.env.local` for configuration (NEXT_PUBLIC_API_URL, BETTER_AUTH_SECRET, etc.)
- **Approval**: Plan will be approved before `/sp.tasks`, tasks approved before `/sp.implement`

**Gate Result**: ✅ **PASS** - All blocking principles satisfied, proceed to Phase 0 research.

---

## Post-Design Constitution Re-Evaluation

*GATE: Re-check after Phase 1 design complete.*

### Design Artifacts Review

**Generated Artifacts**:
- ✅ `research.md`: 8 research areas documented with decisions, alternatives, and rationale
- ✅ `data-model.md`: 8 TypeScript interfaces + Zod schemas with validation rules
- ✅ `contracts/backend-api.md`: 6 API endpoints with request/response specs, error handling, retry logic
- ✅ `quickstart.md`: Complete setup guide with 21 steps for local dev + deployment

**Constitution Compliance Post-Design**:

### Principle I: Spec-Driven Development (SDD) ✅
- **Re-evaluation**: PASS
- **Evidence**: All design artifacts reference spec.md and follow SDD workflow
- **No New Violations**: Design phase followed spec-first approach

### Principle IV: Clean Code and Structure ✅
- **Re-evaluation**: PASS
- **Evidence**:
  - Data models use TypeScript strict mode with Zod runtime validation (zero `any` types)
  - Component architecture follows separation of concerns (UI, services, utils, types)
  - API client implements retry logic per NFR-011 (exponential backoff)
  - File structure mirrors Next.js 16 App Router best practices
- **Complexity Justified**: No unnecessary abstractions introduced

### Principle VII: Ethical and Compliant Development ✅
- **Re-evaluation**: PASS
- **Evidence**:
  - JWT tokens stored in httpOnly cookies (XSS protection, clarified in `/sp.clarify`)
  - API client validates user_id matches JWT claim (enforces data isolation)
  - Retry logic prevents cascading failures (resilience design)
  - CORS configured for specific origins only (security best practice)
- **No New Violations**: Security patterns strengthen compliance

### Principle VIII: Gradual Feature Implementation ✅
- **Re-evaluation**: PASS
- **Evidence**:
  - User Stories prioritized: P0 (Auth) → P1 (Core CRUD) → P2 (Edit/Delete)
  - Data model supports incremental feature delivery (Task create → update → delete)
  - API contract defines minimal viable endpoints (6 endpoints, no over-engineering)
- **No New Violations**: Design supports gradual rollout

**Final Gate Result**: ✅ **PASS** - Design phase complete, all principles satisfied, ready for Phase 2 (tasks generation via `/sp.tasks`).

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
frontend/                        # Next.js 16+ web application
├── app/                         # Next.js App Router directory
│   ├── (auth)/                  # Auth route group (no layout nesting)
│   │   ├── login/
│   │   │   └── page.tsx         # Login page component
│   │   └── signup/
│   │       └── page.tsx         # Signup page component
│   ├── (dashboard)/             # Dashboard route group
│   │   ├── layout.tsx           # Dashboard layout (nav, auth guard)
│   │   └── page.tsx             # Task list dashboard page
│   ├── api/                     # API routes
│   │   └── auth/
│   │       └── [...betterauth]/
│   │           └── route.ts     # Better Auth API handler
│   ├── layout.tsx               # Root layout
│   ├── page.tsx                 # Landing/home page
│   └── globals.css              # Global styles + Tailwind imports
├── components/                  # Reusable React components
│   ├── auth/
│   │   ├── LoginForm.tsx        # Login form with validation
│   │   └── SignupForm.tsx       # Signup form with validation
│   ├── tasks/
│   │   ├── TaskList.tsx         # Task list container
│   │   ├── TaskItem.tsx         # Individual task item
│   │   └── CreateTaskForm.tsx   # Task creation form
│   ├── layout/
│   │   ├── Navigation.tsx       # App navigation bar
│   │   └── Footer.tsx           # App footer
│   └── ui/                      # Generic UI components
│       ├── Button.tsx           # Styled button component
│       ├── Input.tsx            # Styled input component
│       └── Spinner.tsx          # Loading spinner
├── lib/                         # Shared libraries and utilities
│   ├── api/
│   │   └── client.ts            # API client with retry logic
│   ├── auth/
│   │   ├── better-auth.ts       # Better Auth configuration
│   │   └── session.ts           # Session management utilities
│   └── utils/
│       └── validation.ts        # Form validation helpers
├── types/                       # TypeScript type definitions
│   ├── task.ts                  # Task-related types
│   └── user.ts                  # User-related types
├── __tests__/                   # Unit tests (Vitest)
│   ├── components/
│   │   ├── LoginForm.test.tsx
│   │   ├── TaskList.test.tsx
│   │   └── CreateTaskForm.test.tsx
│   └── lib/
│       └── api-client.test.ts
├── e2e/                         # E2E tests (Playwright)
│   ├── auth.spec.ts             # Authentication flows
│   └── tasks.spec.ts            # CRUD operations
├── public/                      # Static assets
│   └── favicon.ico
├── .env.local                   # Environment variables (gitignored)
├── .env.example                 # Environment variables template
├── next.config.ts               # Next.js configuration
├── tailwind.config.ts           # Tailwind CSS configuration
├── tsconfig.json                # TypeScript configuration
├── package.json                 # Node.js dependencies (pnpm)
├── vitest.config.ts             # Vitest test configuration
├── playwright.config.ts         # Playwright E2E configuration
├── CLAUDE.md                    # Frontend development sessions
└── README.md                    # Frontend setup instructions
```

**Structure Decision**: Web application (Option 2) - This is a Next.js frontend that integrates with the existing FastAPI backend. The monorepo structure places frontend code in `/frontend/` directory with complete separation from `/backend/`. This follows Phase II constitution requirement for monorepo structure and enables independent deployment of frontend to Vercel while backend remains on its platform.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

**No violations detected.** All constitution principles are satisfied. Frontend architecture follows established patterns (Next.js App Router, component-based React, API client layer) without unnecessary abstraction.
